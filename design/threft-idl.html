---
layout: page
title: Threft.io IDL
tagline: 
---
{% include JB/setup %}

<style>
	pre {
		font-family: Menlo, monospace;
	}

	pre a {
		cursor: pointer;
	}

	.keywords {
		width: 500px;
	}

	.keyword {
		width: 100px;
		float: left;
	}

</style>
The Threft.io <abbr title="Interface Definition Language">IDL</abbr> is based on the thrift IDL, but is a lot stricter.<br/>
Some features have been removed (senum, cpp_include, cpp_types).

<h3>Notation</h3>
The IDL is specified using Extended Backus-Naur Form (EBNF):
<pre>
Production  = production_name "=" [ Expression ] "." .
Expression  = Alternative { "|" Alternative } .
Alternative = Term { Term } .
Term        = production_name | token [ "…" token ] | Group | Option | Repetition .
Group       = "(" Expression ")" .
Option      = "[" Expression "]" .
Repetition  = "{" Expression "}" .
</pre>
<br/>
Productions are expressions constructed from terms and the following operators, in increasing precedence:
<pre>
|   alternation
()  grouping
[]  option (0 or 1 times)
{}  repetition (0 to n times)
</pre>
<br/>
Lower-case production names are used to identify lexical tokens. Non-terminals are in CamelCase. Lexical tokens are enclosed in double quotes "" or back quotes ``.<br/>
The form a … b represents the set of characters from a through b as alternatives.<br/>

<h3>Basic elements</h3>

<h4>Characters</h4>
<pre>
<a id="newline"          >newline</a>          = /* the Unicode code point U+000A */ .
<a id="unicode_char"     >unicode_char</a>     = /* an arbitrary Unicode code point except newline */ .
<a id="unicode_letter"   >unicode_letter</a>   = /* a Unicode code point classified as "Letter" */ .
<a id="unicode_digit"    >unicode_digit</a>    = /* a Unicode code point classified as "Decimal Digit" */ .
<a id="letter"           >letter</a>           = "a" … "z" | "A" … "Z" .
<a id="letter_lowercase" >letter_lowercase</a> = "a" … "z" .
<a id="decimal_digit"    >decimal_digit</a>    = "0" … "9" .
<a id="decimals"         >decimals</a>         = <a href="#decimal_digit">decimal_digit</a> { <a href="#decimal_digit">decimal_digit</a> } .
</pre>

<h4>Identifier</h4>
An identifier can contain letters, digits, dots and underscores. It must start with a letter or underscore.<br/>
<pre>
<a id="identifier"       >identifier</a>       = <a href="#local_identifier">local_identifier</a> | <a href="#reference">reference</a> .
<a id="reference"        >reference</a>        = <a href="#include_name">include_name</a> "." <a href="#local_identifier">local_identifier</a> .
<a id="local_identifier" >local_identifier</a> = ( <a href="#letter">letter</a> | "_" ) { <a href="#letter">letter</a> | <a href="#decimal_digit">decimal_digit</a> | "_" | "-" } .

lowercase  // local_identifier
Uppercase  // local_identifier
camelCase  // local_identifier
_fooBar    // local_identifier
foo-bar    // local_identifier
errors.EOF // reference
info.foo   // reference
foo.bar.x  // illegal: cannot reference a reference
fooBarç    // illegal: contains invalid character 'ç'
-fooBar    // illegal: does not start with letter or underscore
0fooBar    // illegal: does not start with letter or underscore

</pre>

<h4>String literal</h4>
<pre>
<a id="string_literal" >string_literal</a> = `"` { <a href="#unicode_char">unicode_char</a> | `\"` | "\n" } `"`

"foobar"
"foo"bar"    // illegal: " should be escaped
"foo\"bar"   // \" is escaped to "
"foo\nbar"   // \n is escaped to a newline (unicode code point U+000A)
</pre>

<h4>Keywords</h4>
The following keywords are reserved and may not be used as identifiers.
<div class="keywords" >
	<div class="keyword" >binary</div>
	<div class="keyword" >bool</div>
	<div class="keyword" >byte</div>
	<div class="keyword" >const</div>
	<div class="keyword" >double</div>
	<div class="keyword" >enum</div>
	<div class="keyword" >exception</div>
	<div class="keyword" >extends</div>
	<div class="keyword" >i16</div>
	<div class="keyword" >i32</div>
	<div class="keyword" >i64</div>
	<div class="keyword" >include</div>
	<div class="keyword" >list</div>
	<div class="keyword" >map</div>
	<div class="keyword" >namespace</div>
	<div class="keyword" >optional</div>
	<div class="keyword" >required</div>
	<div class="keyword" >service</div>
	<div class="keyword" >set</div>
	<div class="keyword" >slist</div>
	<div class="keyword" >string</div>
	<div class="keyword" >throws</div>
	<div class="keyword" >typedef</div>
</div>
<div style="clear: both;">&nbsp;</div>

<h3>Types</h3>
<pre>
<a href="#field_type"      >field_type</a>      = <a href="#identifier">identifier</a> | <a href="#base_type">base_type</a> | <a href="#container_type">container_type</a> .
<a href="#definition_type" >definition_type</a> = <a href="#base_type">base_type</a> | <a href="#container_type">container_type</a> //++ TODO move to definition?? .
<a href="#base_type"       >base_type</a>       = "bool" | "byte" | "i16" | "i32" | "i64" | "double" | "string" | "binary" | "slist" .
<a href="#container_type"  >container_type</a>  = <a href="#map_type">map_type</a> | <a href="#set_type">set_type</a> | <a href="#list_type">list_type</a> .
<a href="#map_type"        >map_type</a>        = "map&lt;" <a href="#field_type">field_type</a> "," <a href="#field_type">field_type</a> "&gt;" .
<a href="#set_type"        >set_type</a>        = "set&lt;" <a href="#field_type">field_type</a> "&gt;" .
<a href="#list_type"       >list_type</a>       = "list&lt;" <a href="#field_type">field_type</a> "&gt;" .
</pre>

<h3>Definitions</h3>

<h4>Typedef</h4>
<pre>
<a id="typedef" >typedef</a> = TODO
</pre>

<h4>Constants</h4>
Constants are defined and set with a constant value.
<pre>
<a id="const"               >const</a>              = "const" <a href="#fieldtype">fieldtype</a> <a href="#identifier">identifier</a> "=" <a href="#const_value">const_value</a> .
<a id="const_value"         >const_value</a>        = <a href="#literal">literal</a> | <a href="#identifier">identifier</a> | <a href="#const_value_int">const_value_int</a> | <a href="#const_value_double">const_value_double</a> | <a href="#const_value_list">const_value_list</a> | <a href="#const_value_map">const_value_map</a> .
<a id="const_value_int"     >const_value_int</a>    = ["+" | "-"] <a href="#decimals">decimals</a> .
<a id="const_value_double"  >const_value_double</a> = ["+" | "-"] <a href="#decimals">decimals</a> ["." <a href="#decimals">decimals</a> ] [ ("E" | "e") <a href="#const_value_int">const_value_int</a> ] .
<a id="const_value_list"    >const_value_list</a>   = "[" {<a href="#const_value">const_value</a> } "]" .
<a id="const_value_map"     >const_value_map</a>    = "{" {<a href="#const_value">const_value</a> ":" <a href="#const_value">const_value</a> } "}" .
</pre>

<h4>Enum</h4>
<pre>
<a id="enum" >enum</a> = TODO .
</pre>

<h4>Struct</h4>
<pre>
<a id="struct" >struct</a> = TODO .
</pre>

<h4>Exception</h4>
<pre>
<a id="exception" >exception</a> = TODO .
</pre>

<h4>Service</h4>
<pre>
<a id="service" >service</a> = TODO .
</pre>

<h3>Document</h3>
A document consists of headers and definitions.
<pre>
<a id="document"   >document</a>   = { <a href="#header">header</a> } { <a href="#definition">definition</a> } .
<a id="header"     >header</a>     = <a href="#include">include</a> | <a href="#namespace">namespace</a> .
<a id="definition" >definition</a> = { <a href="#typedef">typedef</a> | <a href="#const">const</a> | <a href="#enum">enum</a> | <a href="#struct">struct</a> | <a href="#exception">exception</a> | <a href="#service">service</a> } .
</pre>

<h4>Include</h4>
Include statements are used to include a set of definition references into a document.
<pre>
<a id="include"      >include</a>      = "include" `"` <a href="#include_name">include_name</a> `.threft"` .
<a id="include_name" >include_name</a> = { <a href="#letter">letter</a> } .

... TODO examples ..
</pre>

<h4>Namespace</h4>
The scope for the definition can be changed for any target (language) a namespace header.
<pre>
<a id="namespace" >namespace</a> = "namespace" <a href="#target">target</a> <a href="#string_literal">string_literal</a> .
<a id="target"    >target</a>    = "*" | ( <a href="#letter_lowercase">letter_lowercase</a> { <a href="#letter_lowercase">letter_lowercase</a> } ) .

... TODO examples ..
</pre>

<script>
	var lastHref = undefined;

	// make given domNode visible
	function showDomNode(targetDomNode) {
		var slideDuration = 400;
		var slideOffset = 200;

		if(targetDomNode != undefined) {
			var targetPostitionTop = $(targetDomNode).position().top - slideOffset;
			if(targetPostitionTop < 0){
				targetPostitionTop = 0;
			}
			$.scrollTo(targetPostitionTop, slideDuration);

			setTimeout(function() {
				$(targetDomNode).effect("highlight");
			}, slideDuration);
		}
	}

	// change the hash without scrolling.
	function setHashWithoutScroll(hash) {
		hash = hash.replace( /^#/, '' );
		var fx, node = $( '#' + hash );
		if ( node.length ) {
			node.attr( 'id', '' );
			fx = $( '<div></div>' )
				.css({
					position:'absolute',
					visibility:'hidden',
					top: $(document).scrollTop() + 'px'
				})
				.attr( 'id', hash )
				.appendTo( document.body );
		}
		document.location.hash = hash;
		if ( node.length ) {
			fx.remove();
			node.attr( 'id', hash );
		}
	}

	// handle click on an anchor to do jQuery scroll to given id.
	$('pre a').click(function(evt) {
		evt.preventDefault();
		var href = $(this).attr('href');
		if(href != undefined && href.length > 0) {
			setHashWithoutScroll(href);
			var targetDomNode = $(href)[0];
			showDomNode(targetDomNode);
		} else {
			console.log('no href set');
		}
	});

	// link all anchors in a pre that have an id set to themselve.
	var anchors = $('pre a');
	for (var i = 0; i < anchors.length; i++) {
		var element = anchors[i];
		var href = $(element).attr('href');
		var id = $(element).attr('id');
		if(href == undefined && id != undefined && id.length > 0) {
			$(element).attr('href', '#'+id);
		}
	}

	if(window.location.hash != undefined && window.location.hash.length > 0) {
		var targetDomNode = $(window.location.hash)[0];
		showDomNode(targetDomNode);
	}

</script>