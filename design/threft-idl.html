---
layout: page
title: Threft.io IDL
tagline: 
---
{% include JB/setup %}

<style>
	pre a {
		cursor: pointer;
	}
</style>
The Threft.io <abbr title="Interface Definition Language">IDL</abbr> is based on the thrift IDL, but is a lot stricter.
Some un-used features are removed.

My current approach to this is to implement the thrift parser into the <a target="_blank" href="https://github.com/threft/threft/tree/master/tidm" >tidm package</a> and write down all things I like/dislike.

<h3>Basic definitions</h3>

<h4>Characters</h4>
<pre>
<a id="newline"               >newline</a>        = /* the Unicode code point U+000A */ .
<a id="unicode_char"     >unicode_char</a>   = /* an arbitrary Unicode code point except newline */ .
<a id="unicode_letter" >unicode_letter</a> = /* a Unicode code point classified as "Letter" */ .
<a id="unicode_digit"   >unicode_digit</a>  = /* a Unicode code point classified as "Decimal Digit" */ .
<a id="letter"                 >letter</a>         = "a" … "z" | "A" … "Z" .
<a id="decimal_digit"   >decimal_digit</a>  = "0" … "9" .
<a id="decimals"             >decimals</a>       = <a href="#decimal_digit">decimal_digit</a> { <a href="#decimal_digit">decimal_digit</a> } .
</pre>

<h4>Identifier</h4>
An identifier can contain letters, digits, dots and underscores. It must start with a letter or underscore.
<pre>
<a id="identifier" >identifier</a> = ( <a href="#letter">letter</a> | "_" ) { <a href="#letter">letter</a> | <a href="#decimal_digit">decimal_digit</a> | "_" | "-" | "." } .

lowercase
Uppercase
camelCase
_fooBar
foo-bar
fooBarç   // illegal: contains invalid character 'ç'
-fooBar   // illegal: does not start with letter or underscore
0fooBar   // illegal: does not start with letter or underscore
</pre>

<h4>String literal</h4>
<pre>
<a id="string_literal" >string_literal</a> = `"` { <a href="#unicode_char">unicode_char</a> | `\"` | "\n" } `"`

"foobar"
"foo"bar"    // illegal: " should be escaped
"foo\"bar"   // \" is escaped to "
"foo\nbar"   // \n is escaped to a newline (unicode code point U+000A)
</pre>

<h3>Constants</h3>
Constants are defined and set with a constant value.

<h4>Constant definitions</h4>
<pre>
<a id="const" >const</a> = "const" <a href="#fieldtype">fieldtype</a> <a href="#identifier">identifier</a> "=" <a href="#const_value">const_value</a>
</pre>

<h4>Constant values</h4>
<pre>
<a id="const_value"         >const_value</a>        = <a href="#literal">literal</a> | <a href="#identifier">identifier</a> | <a href="#const_value_int">const_value_int</a> | <a href="#const_value_double">const_value_double</a> | <a href="#const_value_list">const_value_list</a> | <a href="#const_value_map">const_value_map</a>
<a id="const_value_int"     >const_value_int</a>    = ["+" | "-"] <a href="#decimals">decimals</a>
<a id="const_value_double"  >const_value_double</a> = ["+" | "-"] <a href="#decimals">decimals</a> ["." <a href="#decimals">decimals</a> ] [ ("E" | "e") <a href="#const_value_int">const_value_int</a> ]
<a id="const_value_list"    >const_value_list</a>   = "[" {<a href="#const_value">const_value</a> } "]"
<a id="const_value_map"     >const_value_map</a>    = "{" {<a href="#const_value">const_value</a> ":" <a href="#const_value">const_value</a> } "}"
</pre>


<script>
	var lastHref = undefined;

	// make given domNode visible
	function showDomNode(targetDomNode) {
		var slideDuration = 400;
		var slideOffset = 200;

		if(targetDomNode != undefined) {
			var targetPostitionTop = $(targetDomNode).position().top - slideOffset;
			if(targetPostitionTop < 0){
				targetPostitionTop = 0;
			}
			$.scrollTo(targetPostitionTop, slideDuration);

			// setTimeout(function() {
			// 	$(targetDomNode).effect("highlight");
			// }, slideDuration);
		}
	}

	// change the hash without scrolling.
	function setHashWithoutScroll(hash) {
		hash = hash.replace( /^#/, '' );
		var fx, node = $( '#' + hash );
		if ( node.length ) {
			node.attr( 'id', '' );
			fx = $( '<div></div>' )
				.css({
					position:'absolute',
					visibility:'hidden',
					top: $(document).scrollTop() + 'px'
				})
				.attr( 'id', hash )
				.appendTo( document.body );
		}
		document.location.hash = hash;
		if ( node.length ) {
			fx.remove();
			node.attr( 'id', hash );
		}
	}

	// handle click on an anchor to do jQuery scroll to given id.
	$('pre a').click(function(evt) {
		evt.preventDefault();
		var href = $(this).attr('href');
		if(href != undefined && href.length > 0) {
			setHashWithoutScroll(href);
			var targetDomNode = $(href)[0];
			showDomNode(targetDomNode);
		} else {
			console.log('no href set');
		}
	});

	// link all anchors in a pre that have an id set to themselve.
	var anchors = $('pre a');
	for (var i = 0; i < anchors.length; i++) {
		var element = anchors[i];
		var href = $(element).attr('href');
		var id = $(element).attr('id');
		if(href == undefined && id != undefined && id.length > 0) {
			$(element).attr('href', '#'+id);
		}
	}

	if(window.location.hash != undefined && window.location.hash.length > 0) {
		var targetDomNode = $(window.location.hash)[0];
		showDomNode(targetDomNode);
	}

</script>